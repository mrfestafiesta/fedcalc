<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Outdoor Web App Basis</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        body { margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; background: #000; }
        
        /* Camera Viewport - Top Half */
        #camera-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #222;
        }
        
        video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensures video fills the area */
        }

        /* Map Viewport - Bottom Half */
        #map {
            flex: 1;
            width: 100%;
        }

        /* Overlay UI */
        #status {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: sans-serif;
            z-index: 1000;
        }
    </style>
</head>
<body>

    <div id="status">Initializing...</div>

    <div id="camera-container">
        <video id="video-feed" autoplay playsinline muted></video>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        const statusDiv = document.getElementById('status');
        
        // --- STEP A: Initialize Map ---
        // Default view before GPS loads (coordinates 0,0)
        const map = L.map('map').setView([0, 0], 2);

        // Load tiles from OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Create a marker for the user
        const userMarker = L.marker([0, 0]).addTo(map);

        // --- STEP B: Access Camera ---
        async function startCamera() {
            try {
                // Request video stream
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } // "environment" tries to use the back camera
                });
                const videoElement = document.getElementById('video-feed');
                videoElement.srcObject = stream;
            } catch (err) {
                console.error("Camera Error:", err);
                statusDiv.innerText = "Camera access denied or failed.";
            }
        }

        // --- STEP C: Access GPS ---
        function startTracking() {
            if (!navigator.geolocation) {
                statusDiv.innerText = "Geolocation is not supported by this browser.";
                return;
            }

            // Watch position updates in real-time
            navigator.geolocation.watchPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;

                    // Update Map View
                    const newLatLng = new L.LatLng(lat, lng);
                    userMarker.setLatLng(newLatLng);
                    map.setView(newLatLng, 16); // 16 is zoom level (street view)

                    statusDiv.innerText = `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
                },
                (error) => {
                    console.error("GPS Error:", error);
                    statusDiv.innerText = "Waiting for GPS...";
                },
                {
                    enableHighAccuracy: true, // Critical for outdoor apps
                    maximumAge: 0,
                    timeout: 5000
                }
            );
        }

        // Run functions
        startCamera();
        startTracking();

    </script>
</body>
</html>
